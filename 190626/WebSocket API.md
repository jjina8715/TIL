# WebSocket API

- 웹 소켓이란?

  - 웹에서 서버 푸시 구현을 위한 최적의 기술
    - Polling->LongPolling->ServerSent Events->WebSocket
  - 웹서버와 웹브라우저가 지속적으로 연결된 TCP 라인을 통해 실시간으로 데이터를 주고 받을 수 있도록 하는 HTML5의 새로운 사양
  - 웹 소켓을 이용하면 일반적인 TCP 소켓과 같이 연결지향 양방향 전이중 통신이 가능

- 구현 방법

  - 서버 연결

    - HTML5가 제공하는 WebSocket 객체를 통해 서버 연결을 수행
    - 일반 통신은 ws, 통신은 wss 프로토콜을 이용
    - var ws=new WebSocket("ws://echo.websocket.org/echo");

  - 데이터 통신

    - WebSocket 객체의 sendMessage() 메서드로 데이터를 서버로 송신
    - ws.send("....");

  - 데이터 수신

    - 서버에서 전송되는 데이터를 받으려면 message이벤드를 구현

    - ws.onmessage=function(e){

      ​	log(e.data);

      ​	//메시지가 하나 도착하면 소켓을 닫음

      }

- 웹 소켓 관련 이벤트

  - open : 웹 소켓 서버와 접속이 일어나면 발생하는 이벤트
  - close : 웹 소켓 서버와 접속이 해제되면 발생되는 이벤트
  - message : 웹 소켓 서버로부터 메시지가 전송되면 발생되는 이벤트
  - error : 오류가 발생되면 발생되는 이벤트

- 웹 소켓 프로토콜의 특징

  - TCP의 상위 레벨 프로토콜, IP 주소와 포트번호
    - ws: 로 시작하는 URL 문자열을 사용
  - HTTP 프로토콜로 요청된 다음 websocket 프로토콜로 프로토콜 스위칭이 발생
  - 웹 소켓 서버와의 통신시 클라이언트에서는 웹 메시징 통신과 같이 메시지 전송은 메서드로 수신은 message 이벤트로 처리

- 웹 소켓 서버
  - 웹 소켓 프로토콜을 구현한 서버 프로그램으로서 자바, 파이썬, PHP, 서블릿, 루비 그리고 node.js 기술 등으로 직접 구현하거나 웹 소켓 서버 기능의 프로그램을 설치해서 활용
- 웹 소켓과 폴링 기술의 비교
  - 실시간 통신환경에서는 AJAX를 이용하는 폴링보다 웹 소켓이 월등