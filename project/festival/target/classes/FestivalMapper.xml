<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="resource.FestivalMapper">
 	<select id="selectFestival" parameterType="vo.SearchInfoVO"  resultType="vo.FestivalVO">
 		<![CDATA[  select f.fid, f.name, f.lat, f.lng, f.place, f.opendate, f.closedate
 		from (select fid, name, lat, lng, place, to_char(opendate, 'yyyy/mm/dd') opendate, to_char(closedate, 'yyyy/mm/dd') closedate
    		from festival
    		where type like '%'||#{type}||'%' and place like '%'||#{place}||'%' and fid = (
    			select fid
    			from festadate
    			where to_char(opendate, 'mm') like '%'||#{month}||'%') 
    		order by fid desc
    		) f
    	where ROWNUM >= #{startRow} and ROWNUM <= #{size} and img.fid = f.fid]]>
 	</select>
 	<select id="selectFestivalImage" parameterType="_int" resultType="java.sql.Blob">
 		select image
 		from festaimg
 		where fid=${fid}
 	</select>
 	<select id="selectFestivalCount" parameterType="vo.SearchInfoVO" resultType="_int">
 		select count(*) from festival
 		where type like '%'||#{type}||'%' and place like '%'||#{place}||'%' and fid = (
    		select fid
    		from festadate
    		where to_char(opendate, 'mm') like '%'||#{month}||'%'
    	)
 	</select>
</mapper>