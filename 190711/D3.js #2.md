# D3.js #2

<h3>정보 시각화 데이터 흐름</h3>
**데이터**

- 데이터 시각화 절차 

  1. 로딩

     - d3는 XML, SCV, JSON 포맷의 문서로 되어 있는 데이터를 가져와 사용할 수 있는 메서드를 여러 개 제공
     - 여러 포맷의 차이는 궁극적으로 데이터를 어떻게 모델링하느냐 하는 것
     - CSV로 표현할 수 없는 내포된 관계를 JSON과 XML로는 표현 가능
     - d3.csv()와 d3.json() 메서드는 JSON 객체의 배열을 생성하지만, d3.xml() 메서드는 이와 다른 방식으로 접근해야 하는 XML 문서를 생성
     - d3는 파일 포맷에 따라 총 5개의 메서드를 제공. text() xml() json() csv() html()
     - d3.csv와 d3.json은 로딩할 파일의 경로와 콜백 함수를 인자로 받는다.콜백 함수에서 가장 먼저 데이터에 접근하며, 이 데이터를 다른 곳에서도 사용하려면 받은 데이터를 전역 변수에 할당해야 한다.
       - csv파일을 로딩하면 배열 객체를 반환
       - json파일을 로딩하면 여러 이름-값 쌍을 담고 있는 객체를 반환
       - 두 함수 모두 비동기식으로 실행되므로 요청한 후 파일이 로딩되기 전에 메서드를 반환. 경우에 따라 데이터가 로딩되기 전에 그 데이터를 필요로 하는 코드를 실행하면 오류가 발생한다.
         - 이런 문제는 1. 데이터 로딩 함수 안에 데이터 처리함수를 두거나 2. queue.js와 같은 헬퍼 라이브러리로 파일 로딩이 완료될 때 이벤트를 발생시켜 피할 수 있다.
       - d3.csv() 메서드에는 외부 파일 대신 일련의 텍스트 블록에 사용할 수 있는 parse()메서드가 있다.
     - 데이터를 가져오는 과정을 직접 제어하려면 데이터 송신과 수신을 섬세하게 제어할 수 있는 d3.xhr() 메서드를 참조

  2. 포맷

     - 데이터셋을 로딩한 후에는 데이터의 속성으로 그래픽 요소의 색상, 크기, 위치를 직접 설정하는 메서드 정의

     [데이터 포맷팅]

     - 정량적 데이터
       - 크기, 위치, 색상을 표현 가능
       - d3.scale() 메서드로 스케일scale을 정의하거나 수치를 그룹화하는 분위quantile 등의 기법으로 범주 데이터로 변환함으로써 정규화nomalization해야 한다.
     - 범주 데이터
       - 불연속 그룹으로 분류. 일반적으로 문자열로 표현
       - 속성에 따라 그룹화된 요소의 패턴을 알아내려  종종 도형이나 색상으로도 표현.
     - 위상 데이터
       - 데이터 간의 관계 표현, 일종의 위치 데이터
       - 위상 속성은 고유한 id값을 뜻하는 덱스트나 다른 객체를 가리키는 포인터로 표현 가능
     - 기하학적 데이터
       - 주로 지리 데이터의 경계나 노선과 관련이 깊다. 
       - 원하는 벡터 아이콘을 그리는 sgv코드, 도형의 형태를 규정하는 텍스트, 혹은 도형의 크기를 나타내는 수치형 값
     - 날씨/시간 데이터
       - 연월일 숫자 혹은 복잡한 계산을 위해 특별한 날짜 형식으로 표현 가능
       - ISO 8601이 가장 널리 사용하는 형식
     - 원시 데이터
       - 일반적으로 텍스트와 그림은 원시형태로 구조를 갖추고 있지 않은 데이터

     [데이터 변환]

     - 여러 형식의 데이터를 처리할 때는 데이터의 형을 표현하기 좋은 다른 형으로 바꾸는 편이 좋다. 

     - 캐스팅 : 데이터 형변환

       - 날짜, 정수형, 실수형, 배열에 상관없이 데이터는 문자열형으로 로딩하는 것이 보통. 반대로 변환하기도 한다.

     - 정규화 : 스케일과 규모 변경

       - 수치형 데이터를 화면의 위치나 크기에 대응시키려면 일반적으로 d3.scale() 메서드로 데이터를 정규화
       - d3.scale().linear() : 하나의 범위에 있는 값을 다른 범위의 값으로 선형 대응
         - 스케일은 각기 배열로 설정되는 도메인domain과 레인지range를 가졌다.
         - 도메인은 변환 전 값의 범위를, 레인지는 변환 후 값의 범위 지정. (함수에서의 정의역과 치역이라 볼 수 있다.)
       - 데이터셋에 따라 d3.scale.log(), d3.scale.pow(), d3.scale.ordinal() 등의 메서드를 사용해 데이터를 대응한다.

     - 비닝 : 데이터 분류

       - 일련의 범위에 있는 값으로 그룹화함으로써 정량적 데이터를 범주로 분류하는 것도 유용, 배열을 같은 크기의 부분으로 나누어 변윗값quantile을 사용 가능
       - 변윗값 스케일 : d3.scale.quantile() 다른 스케일과 동일하게 설정
         - 부분의 개수와 각 부분의 레이블은 range() 메서드로 설정
       - domain()에 들어있는 값의 개수와 range()에 들어있는 값의 개수가 다르다면 도메인에 있는 값들을 더 적은 수의 레인지에 있는 값으로 자동으로 정렬해 비닝binning한다.
       - domain() 메서드를 호출할 때 숫자 배열을 오름차순으로 정렬하고 적절한 지점을 기준으로 나누어 범주를 생성, 변윗값 스케일에 전달된 숫자들은 모두 이 분할점을 기준으로 설정한 범주 중 하나를 반환

     - 내포

       - 데이터의 계층 구조 표현은 가계도처럼 전통적으로 명확한 계층을 나타내는 데이터뿐 만 아니라 다양하게 사용 가능
       - 내포 함수 : d3.nest() ....
       - 내포는 데이터에 공통된 속성으로 데이터를 불연속적인 범주에 분류할 수 있다는 생각에서 출발
       - ex)

       ```javascript
       d3.json("tweets.json", function(data){
           var tweetData = data.tweets;
           var nestedTweets = d3.nest()
           					.key(function(el){return el.uesr})
           					.entries(tweetData);
       }) //nest()함수는 uesr 속성값을 키로 갖는 객체의 배열을 새로 생성
       ```

